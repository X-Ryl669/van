let e,t,r,l,o,n,s=Object,f=s.getPrototypeOf,i={isConnected:1},a={},h=f(i),d=f(f),w="remove",u="eventListener",_=Set,c=document,g=(e,t,r,l)=>(e??(setTimeout(r,l),new _)).add(t),v=(e,t,l)=>{let o=r;r=t;try{return e(l)}catch(e){return console.error(e),l}finally{r=o}},y=e=>e.filter(e=>e.t?.isConnected),m=e=>o=g(o,e,()=>{for(let e of o)e.l=y(e.l),e.o=y(e.o);o=n},1e3),x={get val(){return r?.i?.add(this),this.rawVal},get oldVal(){return r?.i?.add(this),this.h},set val(l){r?.u?.add(this),l!==this.rawVal&&(this.rawVal=l,this.l.length+this.o.length?(t?.add(this),e=g(e,this,C)):this.h=l)}},V=e=>({__proto__:x,rawVal:e,h:e,l:[],o:[]}),b=(e,t)=>{let r={i:new _,u:new _},o={f:e},n=l;l=[];let s=v(e,r,t);s=(s??c).nodeType?s:new Text(s);for(let e of r.i)r.u.has(e)||(m(e),e.l.push(o));for(let e of l)e.t=s;return l=n,o.t=s},p=(e,t=V(),r)=>{let o={i:new _,u:new _},n={f:e,s:t};n.t=r??l?.push(n)??i,t.val=v(e,o,t.rawVal);for(let e of o.i)o.u.has(e)||(m(e),e.o.push(n));return t},P=(e,...t)=>{for(let r of t.flat(1/0)){let t=f(r??0),l=t===x?b(()=>r.val):t===d?b(r):r;l!=n&&e.append(l)}return e},S=(e,t,...r)=>{let[l,...o]=f(r[0]??0)===h?r:[{},...r],i=c["createElement"+e&&"NS"](e||t,t);for(let[e,r]of s.entries(l)){let l=t=>t?s.getOwnPropertyDescriptor(t,e)??l(f(t)):n,o=t+","+e,h=a[o]??=l(f(i))?.set??0,_=e.startsWith("on"),c=_?(t,r)=>{let l=e.slice(2);i[w+u](l,r),i["add"+u](l,t)}:h?h.bind(i):i.setAttribute.bind(i,e),g=f(r??0);_||g===d&&(r=p(r),g=x),g===x?b(()=>(c(r.val,r.h),i)):c(r)}return P(i,o)},T=e=>({get:(t,r)=>S.bind(n,e,r)}),j=(e,t)=>t===e||e[t?"replaceWith":w](t),C=()=>{let r=0,l=[...e].filter(e=>e.rawVal!==e.h);do{t=new _;for(let e of new _(l.flatMap(e=>e.o=y(e.o))))p(e.f,e.s,e.t),e.t=n}while(++r<100&&(l=[...t]).length);let o=[...e].filter(e=>e.rawVal!==e.h);e=n;for(let e of new _(o.flatMap(e=>e.l=y(e.l))))j(e.t,b(e.f,e.t)),e.t=n;for(let e of o)e.h=e.rawVal};export default{tags:new Proxy(e=>new Proxy(S,T(e)),T()),hydrate:(e,t)=>j(e,b(t,e)),add:P,state:V,derive:p};